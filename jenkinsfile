pipeline {
  agent { docker {image "python:3"} }
  stages { 
        stage('set-up'){
           steps{ 
              sh 'docker --version'
              sh 'python -m pip install pylint'
              sh 'python -m pip install Django'
           }
        }
        stage('lint'){
          steps{ 
               script {
                 def ret = sh(script: 'pylint ./rp-portfolio', returnStatus: true)
                 if( ret != 0 ){
                  currentBuild.result = 'UNSTABLE'
                 }
               }
          }
        }
        stage('deploy') {
            steps {
               sh 'cp -r ./rp-portfolio /deploy'
               dir("/deploy/rp-portfolio") {
                  sh "ls -l"
                  sh 'python manage.py makemigrations'
                  sh 'python manage.py migrate'
              }
           }
        }
    }
}
