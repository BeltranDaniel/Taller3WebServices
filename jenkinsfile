pipeline {
  agent any
  stages { 
        stage('set-up'){
           steps{
              sh 'docker restart python'
           }
        }
        stage('lint'){
          steps{ 
               script {
                 def ret = sh(script: 'pylint ./rp-portfolio', returnStatus: true)
                 if( ret != 0 ){
                  currentBuild.result = 'UNSTABLE'
                 }
               }
          }
        }
        stage('deploy') {
            steps {
               sh 'cp -r ./rp-portfolio /deploy'
               
               sh 'docker exec python python rp-portfolio/manage.py makemigrations'
               sh 'python exec python rp-portfolio/manage.py migrate'

              
           }
        }
    }
}
