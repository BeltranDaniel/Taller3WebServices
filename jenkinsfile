pipeline {
  agent any
  stages { 
        stage('set-up'){
           steps{
              sh 'docker restart python'
           }
        }
        stage('lint'){
          steps{ 
               script {
                 def ret = sh(script: 'pylint ./rp-portfolio', returnStatus: true)
                 if( ret != 0 ){
                  currentBuild.result = 'UNSTABLE'
                 }
               }
          }
        }
        stage('deploy') {
            steps {
               sh 'cp -r ./rp-portfolio /deploy'
               dir("/deploy/rp-portfolio") {
                  sh "ls -l"
                  sh 'docker exec python python manage.py makemigrations'
                  sh 'python exec python manage.py migrate'
                  
              }
           }
        }
    }
}
